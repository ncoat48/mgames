<!DOCTYPE html>
<html lang="en">

<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Turbo Racer - Car Racing Game</title>
Â  <style>
Â  Â  * {
Â  Â  Â  box-sizing: border-box;
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  }

Â  Â  body {
Â  Â  Â  margin: 0;
Â  Â  Â  overflow: hidden;
Â  Â  Â  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  height: 100vh;
Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
Â  Â  Â  color: white;
Â  Â  Â  position: relative;
Â  Â  }

Â  Â  body::before {
Â  Â  Â  content: '';
Â  Â  Â  position: absolute;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  background:
Â  Â  Â  Â  radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
Â  Â  Â  Â  radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.15) 0%, transparent 50%),
Â  Â  Â  Â  radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
Â  Â  Â  z-index: -1;
Â  Â  }

Â  Â  .game-header {
Â  Â  Â  text-align: center;
Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  z-index: 10;
Â  Â  Â  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
Â  Â  }

Â  Â  h1 {
Â  Â  Â  font-size: 2.8rem;
Â  Â  Â  margin-bottom: 5px;
Â  Â  Â  background: linear-gradient(to right, #ff6b6b, #ffd166, #06d6a0);
Â  Â  Â  -webkit-background-clip: text;
Â  Â  Â  background-clip: text;
Â  Â  Â  color: transparent;
Â  Â  Â  letter-spacing: 2px;
Â  Â  }

Â  Â  .game-subtitle {
Â  Â  Â  font-size: 1rem;
Â  Â  Â  color: #b8c2cc;
Â  Â  Â  margin-bottom: 10px;
Â  Â  }

Â  Â  #gameArea {
Â  Â  Â  position: relative;
Â  Â  Â  /* MODIFIED: Flexible width with a max */
Â  Â  Â  width: 95vw;
Â  Â  Â  max-width: 400px;
Â  Â  Â  height: 600px;
Â  Â  Â  background:
Â  Â  Â  Â  linear-gradient(to bottom, #2d3748 0%, #1a202c 100%);
Â  Â  Â  border-radius: 12px;
Â  Â  Â  overflow: hidden;
Â  Â  Â  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
Â  Â  Â  border: 2px solid rgba(255, 255, 255, 0.1);
Â  Â  }

Â  Â  #gameArea::before {
Â  Â  Â  content: '';
Â  Â  Â  position: absolute;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  background:
Â  Â  Â  Â  repeating-linear-gradient(to bottom,
Â  Â  Â  Â  Â  transparent 0px,
Â  Â  Â  Â  Â  transparent 119px,
Â  Â  Â  Â  Â  rgba(255, 255, 255, 0.03) 120px,
Â  Â  Â  Â  Â  rgba(255, 255, 255, 0.03) 121px);
Â  Â  Â  z-index: 1;
Â  Â  }

Â  Â  .roadLine {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 8px;
Â  Â  Â  height: 60px;
Â  Â  Â  background: linear-gradient(to bottom, transparent 0%, #f8f9fa 10%, #f8f9fa 90%, transparent 100%);
Â  Â  Â  left: 50%;
Â  Â  Â  transform: translateX(-50%);
Â  Â  Â  border-radius: 4px;
Â  Â  Â  box-shadow: 0 0 10px rgba(248, 249, 250, 0.7);
Â  Â  Â  z-index: 2;
Â  Â  }

Â  Â  .car,
Â  Â  .enemy {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 60px;
Â  Â  Â  height: 100px;
Â  Â  Â  border-radius: 10px 10px 15px 15px;
Â  Â  Â  z-index: 5;
Â  Â  Â  transition: left 0.2s ease;
Â  Â  }

Â  Â  .car {
Â  Â  Â  background: linear-gradient(135deg, #ff6b6b 0%, #e63946 100%);
Â  Â  Â  bottom: 30px;
Â  Â  Â  left: 170px;
Â  Â  Â  box-shadow:
Â  Â  Â  Â  0 5px 15px rgba(230, 57, 70, 0.5),
Â  Â  Â  Â  inset 0 2px 0 rgba(255, 255, 255, 0.3),
Â  Â  Â  Â  inset 0 -2px 0 rgba(0, 0, 0, 0.3);
Â  Â  Â  border: 2px solid rgba(255, 255, 255, 0.2);
Â  Â  }

Â  Â  .car::before,
Â  Â  .car::after {
Â  Â  Â  content: '';
Â  Â  Â  position: absolute;
Â  Â  Â  width: 15px;
Â  Â  Â  height: 15px;
Â  Â  Â  background: rgba(255, 255, 255, 0.7);
Â  Â  Â  border-radius: 50%;
Â  Â  Â  top: 20px;
Â  Â  }

Â  Â  .car::before {
Â  Â  Â  left: 8px;
Â  Â  }

Â  Â  .car::after {
Â  Â  Â  right: 8px;
Â  Â  }

Â  Â  .car-window {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 40px;
Â  Â  Â  height: 25px;
Â  Â  Â  background: linear-gradient(135deg, #a8dadc 0%, #457b9d 100%);
Â  Â  Â  border-radius: 5px;
Â  Â  Â  top: 15px;
Â  Â  Â  left: 10px;
Â  Â  Â  box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
Â  Â  }

Â  Â  .enemy {
Â  Â  Â  box-shadow:
Â  Â  Â  Â  0 5px 15px rgba(0, 0, 0, 0.5),
Â  Â  Â  Â  inset 0 2px 0 rgba(255, 255, 255, 0.2),
Â  Â  Â  Â  inset 0 -2px 0 rgba(0, 0, 0, 0.3);
Â  Â  Â  border: 2px solid rgba(255, 255, 255, 0.1);
Â  Â  }
.back-btn-2 {
Â  Â  Â  position: fixed;
Â  Â  Â  top: 15px;
Â  Â  Â  left: 15px;
Â  Â  Â  padding: 8px 16px;
Â  Â  Â  font-size: 14px;
Â  Â  Â  background: #4a90e2;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 20px;
Â  Â  Â  color: white;
Â  Â  Â  text-decoration: none;
Â  Â  Â  cursor: pointer;
Â  Â  Â  z-index: 1000;
Â  Â  Â  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  }

Â  Â  .back-btn-2:hover {
Â  Â  Â  background: #357ae8;
Â  Â  Â  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
Â  Â  }

Â  Â  .enemy::before,
Â  Â  .enemy::after {
Â  Â  Â  content: '';
Â  Â  Â  position: absolute;
Â  Â  Â  width: 15px;
Â  Â  Â  height: 15px;
Â  Â  Â  background: rgba(255, 255, 255, 0.7);
Â  Â  Â  border-radius: 50%;
Â  Â  Â  top: 20px;
Â  Â  }

Â  Â  .enemy::before {
Â  Â  Â  left: 8px;
Â  Â  }

Â  Â  .enemy::after {
Â  Â  Â  right: 8px;
Â  Â  }

Â  Â  .enemy-window {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 40px;
Â  Â  Â  height: 25px;
Â  Â  Â  background: linear-gradient(135deg, #a8dadc 0%, #457b9d 100%);
Â  Â  Â  border-radius: 5px;
Â  Â  Â  top: 15px;
Â  Â  Â  left: 10px;
Â  Â  Â  box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
Â  Â  }

Â  Â  .score-container {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  /* MODIFIED: Match game area width */
Â  Â  Â  width: 95vw;
Â  Â  Â  max-width: 400px;
Â  Â  Â  margin-top: 15px;
Â  Â  Â  padding: 0 10px;
Â  Â  }

Â  Â  #score,
Â  Â  #speed {
Â  Â  Â  background: rgba(0, 0, 0, 0.4);
Â  Â  Â  padding: 8px 15px;
Â  Â  Â  border-radius: 20px;
Â  Â  Â  font-family: 'Courier New', monospace;
Â  Â  Â  font-size: 1.2em;
Â  Â  Â  font-weight: bold;
Â  Â  Â  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
Â  Â  Â  backdrop-filter: blur(5px);
Â  Â  Â  border: 1px solid rgba(255, 255, 255, 0.1);
Â  Â  }

Â  Â  #score {
Â  Â  Â  color: #06d6a0;
Â  Â  }

Â  Â  #speed {
Â  Â  Â  color: #ffd166;
Â  Â  }

Â  Â  /* Touch controls */
Â  Â  #controls {
Â  Â  Â  display: none;
Â  Â  Â  /* MODIFIED: Hidden by default now */
Â  Â  Â  width: 100%;
Â  Â  Â  justify-content: center;
Â  Â  Â  margin-top: 20px;
Â  Â  Â  gap: 30px;
Â  Â  }

Â  Â  .btn {
Â  Â  Â  background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  font-size: 2em;
Â  Â  Â  width: 80px;
Â  Â  Â  height: 80px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  user-select: none;
Â  Â  Â  box-shadow:
Â  Â  Â  Â  0 5px 15px rgba(0, 0, 0, 0.3),
Â  Â  Â  Â  inset 0 2px 0 rgba(255, 255, 255, 0.2);
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  transition: all 0.1s ease;
Â  Â  Â  border: 2px solid rgba(255, 255, 255, 0.1);
Â  Â  }

Â  Â  .btn:active {
Â  Â  Â  transform: scale(0.95);
Â  Â  Â  box-shadow:
Â  Â  Â  Â  0 2px 5px rgba(0, 0, 0, 0.3),
Â  Â  Â  Â  inset 0 2px 0 rgba(255, 255, 255, 0.1);
Â  Â  }

Â  Â  /* MODIFIED: Removed the media query that set fixed widths */
Â  Â  @media (max-width: 700px) {
Â  Â  Â  /*
Â  Â  Â  #controls {
Â  Â  Â  Â  display: flex;
Â  Â  Â  }
Â  Â  Â  */
Â  Â  }

Â  Â  /* Game over overlay */
Â  Â  #gameOver {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  background: rgba(0, 0, 0, 0.85);
Â  Â  Â  display: none;
Â  Â  Â  flex-direction: column;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  z-index: 100;
Â  Â  Â  border-radius: 12px;
Â  Â  }

Â  Â  #gameOver h2 {
Â  Â  Â  font-size: 3rem;
Â  Â  Â  color: #ff6b6b;
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  text-shadow: 0 0 20px rgba(255, 107, 107, 0.7);
Â  Â  }

Â  Â  #gameOver p {
Â  Â  Â  font-size: 1.5rem;
Â  Â  Â  margin-bottom: 30px;
Â  Â  }

Â  Â  #restartBtn {
Â  Â  Â  background: linear-gradient(135deg, #06d6a0 0%, #04a77c 100%);
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  padding: 12px 30px;
Â  Â  Â  font-size: 1.2rem;
Â  Â  Â  border-radius: 50px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  box-shadow: 0 5px 15px rgba(6, 214, 160, 0.4);
Â  Â  Â  transition: all 0.3s ease;
Â  Â  }

Â  Â  #restartBtn:hover {
Â  Â  Â  transform: translateY(-3px);
Â  Â  Â  box-shadow: 0 8px 20px rgba(6, 214, 160, 0.6);
Â  Â  }

Â  Â  /* Particle effects */
Â  Â  .particle {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 10px;
Â  Â  Â  height: 10px;
Â  Â  Â  background: white;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  pointer-events: none;
Â  Â  Â  z-index: 20;
Â  Â  }

Â  Â  /* Speed lines effect */
Â  Â  .speed-line {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 2px;
Â  Â  Â  height: 30px;
Â  Â  Â  background: rgba(255, 255, 255, 0.7);
Â  Â  Â  border-radius: 1px;
Â  Â  Â  z-index: 1;
Â  Â  }
Â  </style>
</head>

<body>
Â  <div class="game-header">
Â  Â  Â  <h1>ğŸš— TURBO RACER ğŸ</h1>
Â  Â  Â  <div class="game-subtitle">Avoid the oncoming cars and set a high score!</div>
Â  </div>
Â  <a href="../index.html" class="back-btn-2">â† Back</a>

Â  <div class="score-container">
Â  Â  Â  <div id="score">Score: 0</div>
Â  Â  Â  <div id="speed">Speed: 5</div>
Â  </div>

Â  <div id="gameArea">
Â  Â  Â  <div id="gameOver">
Â  Â  Â  Â  Â  <h2>ğŸ’¥ GAME OVER</h2>
Â  Â  Â  Â  Â  <p>Your Score: <span id="finalScore">0</span></p>
Â  Â  Â  Â  Â  <button id="restartBtn">PLAY AGAIN</button>
Â  Â  Â  Â  </div>
Â  </div>

Â  <div id="controls">
Â  Â  Â  <button class="btn" id="leftBtn">â¬…ï¸</button>
Â  Â  Â  <button class="btn" id="rightBtn">â¡ï¸</button>
Â  </div>

Â  <script>
Â  Â  const gameArea = document.getElementById('gameArea');
Â  Â  const scoreDisplay = document.getElementById('score');
Â  Â  const speedDisplay = document.getElementById('speed');
Â  Â  const gameOverScreen = document.getElementById('gameOver');
Â  Â  const finalScoreDisplay = document.getElementById('finalScore');
Â  Â  const restartBtn = document.getElementById('restartBtn');

Â  Â  let player = { speed: 5, score: 0, lane: 2, start: false };
Â  Â  let keys = { ArrowLeft: false, ArrowRight: false };
Â  Â  let lines = [];
Â  Â  let enemies = [];
Â  Â  let animationId;
Â  Â  let lanePositions = []; // MODIFIED: Made dynamic
Â  Â  let particles = [];
Â  Â  let speedLines = [];
Â  Â  let playerTop; // NEW: To cache player's top position for performance

Â  Â  // NEW: Variables for swipe controls
Â  Â  let touchStartX = 0;
Â  Â  let touchStartY = 0;

Â  Â  // Create road lines
Â  Â  for (let i = 0; i < 6; i++) {
Â  Â  Â  let line = document.createElement('div');
Â  Â  Â  line.classList.add('roadLine');
Â  Â  Â  line.y = i * 120;
Â  Â  Â  line.style.top = line.y + "px";
Â  Â  Â  gameArea.appendChild(line);
Â  Â  Â  lines.push(line);
Â  Â  }

Â  Â  // Create player car
Â  Â  const car = document.createElement('div');
Â  Â  car.classList.add('car');
Â  Â  const carWindow = document.createElement('div');
Â  Â  carWindow.classList.add('car-window');
Â  Â  car.appendChild(carWindow);
Â  Â  gameArea.appendChild(car);

Â  Â  // NEW: Function to set up game dimensions dynamically
Â  Â  function setupGameDimensions() {
Â  Â  Â  const gameWidth = gameArea.clientWidth;
Â  Â  Â  const carWidth = 60; // From our CSS
Â  Â  Â  const laneWidth = gameWidth / 4;

Â  Â  Â  // Store old positions to migrate existing enemies on resize
Â  Â  Â  const oldLanePositions = [...lanePositions];

Â  Â  Â  // Calculate new lane center points, minus half a car width
Â  Â  Â  lanePositions = [
Â  Â  Â  Â  (laneWidth * 0.5) - (carWidth / 2),
Â  Â  Â  Â  (laneWidth * 1.5) - (carWidth / 2),
Â  Â  Â  Â  (laneWidth * 2.5) - (carWidth / 2),
Â  Â  Â  Â  (laneWidth * 3.5) - (carWidth / 2)
Â  Â  Â  ];

Â  Â  Â  // Update player car's position
Â  Â  Â  if (player.start) {
Â  Â  Â  Â  car.style.left = lanePositions[player.lane] + "px";
Â  Â  Â  }

Â  Â  Â  // Update existing enemies if resizing mid-game
Â  Â  Â  if (oldLanePositions.length === 4) {
Â  Â  Â  Â  enemies.forEach(enemy => {
Â  Â  Â  Â  Â  const oldLeft = parseFloat(enemy.style.left);
Â  Â  Â  Â  Â  let oldLaneIndex = -1;
Â  Â  Â  Â  Â  for (let i = 0; i < oldLanePositions.length; i++) {
Â  Â  Â  Â  Â  Â  // Use a small tolerance for float comparison
Â  Â  Â  Â  Â  Â  if (Math.abs(oldLeft - oldLanePositions[i]) < 1) {
Â  Â  Â  Â  Â  Â  Â  oldLaneIndex = i;
Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  if (oldLaneIndex !== -1) {
Â  Â  Â  Â  Â  Â  enemy.style.left = lanePositions[oldLaneIndex] + "px";
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  }
Â  Â  }

Â  Â  // Create enemies ensuring at least one lane remains empty
Â  Â  function createEnemies() {
Â  Â  Â  enemies.forEach(e => e.remove());
Â  Â  Â  enemies = [];

Â  Â  Â  const lanesUsed = new Set();
Â  Â  Â  const totalEnemies = Math.floor(Math.random() * 3) + 2; // 2â€“4 enemies per wave

Â  Â  Â  while (lanesUsed.size < totalEnemies) {
Â  Â  Â  Â  const randomLane = Math.floor(Math.random() * 4);
Â  Â  Â  Â  lanesUsed.add(randomLane);
Â  Â  Â  }

Â  Â  Â  // Ensure at least one lane is empty
Â  Â  Â  if (lanesUsed.size === 4) {
Â  Â  Â  Â  lanesUsed.delete([...lanesUsed][Math.floor(Math.random() * 4)]);
Â  Â  Â  }

Â  Â  Â  lanesUsed.forEach(laneIndex => {
Â  Â  Â  Â  let enemy = document.createElement('div');
Â  Â  Â  Â  enemy.classList.add('enemy');

Â  Â  Â  Â  // Random enemy colors
Â  Â  Â  Â  const colors = [
Â  Â  Â  Â  Â  'linear-gradient(135deg, #ffd166 0%, #ffb700 100%)',
Â  Â  Â  Â  Â  'linear-gradient(135deg, #06d6a0 0%, #04a77c 100%)',
Â  Â  Â  Â  Â  'linear-gradient(135deg, #118ab2 0%, #0a6c8f 100%)',
Â  Â  Â  Â  Â  'linear-gradient(135deg, #ef476f 0%, #d90429 100%)',
Â  Â  Â  Â  Â  'linear-gradient(135deg, #7209b7 0%, #560bad 100%)'
Â  Â  Â  Â  ];

Â  Â  Â  Â  enemy.style.background = colors[Math.floor(Math.random() * colors.length)];

Â  Â  Â  Â  enemy.y = -120 - Math.random() * 200;
Â  Â  Â  Â  // MODIFIED: Uses dynamic lane position
Â  Â  Â  Â  enemy.style.left = lanePositions[laneIndex] + "px";
Â  Â  Â  Â  enemy.style.top = enemy.y + "px";

Â  Â  Â  Â  const enemyWindow = document.createElement('div');
Â  Â  Â  Â  enemyWindow.classList.add('enemy-window');
Â  Â  Â  Â  enemy.appendChild(enemyWindow);

Â  Â  Â  Â  gameArea.appendChild(enemy);
Â  Â  Â  Â  enemies.push(enemy);
Â  Â  Â  });
Â  Â  }

Â  Â  function moveLines() {
Â  Â  Â  lines.forEach(line => {
Â  Â  Â  Â  line.y += player.speed;
Â  Â  Â  Â  if (line.y > 600) line.y -= 720;
Â  Â  Â  Â  line.style.top = line.y + "px";
Â  Â  Â  });
Â  Â  }

Â  Â  function moveEnemies() {
Â  Â  Â  enemies.forEach(enemy => {
Â  Â  Â  Â  enemy.y += player.speed;
Â  Â  Â  Â  enemy.style.top = enemy.y + "px";

Â  Â  Â  Â  if (enemy.y > 600) {
Â  Â  Â  Â  Â  enemy.remove();
Â  Â  Â  Â  Â  enemies = enemies.filter(e => e !== enemy);
Â  Â  Â  Â  Â  if (enemies.length === 0) {
Â  _ Â  Â  Â  Â  Â  player.score++;
Â  Â  Â  Â  Â  Â  scoreDisplay.textContent = "Score: " + player.score;
Â  Â  Â  Â  Â  Â  createEnemies();
Â  Â  Â  Â  Â  Â  player.speed += 0.2; // Gradual speed increase
Â  Â  Â  Â  Â  Â  speedDisplay.textContent = "Speed: " + Math.floor(player.speed * 10) / 10;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  // MODIFIED: Use fast collision check
Â  Â  Â  Â  if (fastCollide(enemy)) {
Â  Â  Â  Â  Â  createExplosion(car.offsetLeft + 30, car.offsetTop + 50);
Â  Â  Â  Â  Â  endGame();
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  }

Â  Â  // REPLACED: Fast collision check
Â  Â  function fastCollide(enemy) {
Â  Â  Â  // Player properties (width/height are 60x100 from CSS)
Â  Â  Â  let pLeft = car.offsetLeft;
Â  Â  Â  let pRight = pLeft + 60;
Â  Â  Â  let pTop = playerTop; // Use cached value
Â  Â  Â  let pBottom = pTop + 100;

Â  Â  Â  // Enemy properties (width/height are 60x100 from CSS)
Â  Â  Â  let eLeft = enemy.offsetLeft;
Â  Â  Â  let eRight = eLeft + 60;
Â  Â  Â  let eTop = enemy.y; // Use tracked .y variable
Â  Â  Â  let eBottom = eTop + 100;

Â  Â  Â  // AABB (Axis-Aligned Bounding Box) collision check
Â  Â  Â  return !(
Â  Â  Â  Â  pTop > eBottom ||
Â  Â  Â  Â  pBottom < eTop ||
Â  Â  Â  Â  pLeft > eRight ||
Â  Â  Â  Â  pRight < eLeft
Â  Â  Â  );
Â  Â  }

Â  Â  function createExplosion(x, y) {
Â  Â  Â  for (let i = 0; i < 15; i++) {
Â  Â  Â  Â  let particle = document.createElement('div');
Â  Â  Â  Â  particle.classList.add('particle');
Â  Â  Â  Â  particle.style.left = x + "px";
Â  Â  Â  Â  particle.style.top = y + "px";
Â  Â  Â  Â  particle.style.background = i % 2 === 0 ? '#ff6b6b' : '#ffd166';

Â  Â  Â  Â  const angle = Math.random() * Math.PI * 2;
Â  Â  Â  Â  const speed = 2 + Math.random() * 4;
Â  Â  Â  Â  const vx = Math.cos(angle) * speed;
Â  Â  Â  Â  const vy = Math.sin(angle) * speed;

Â  Â  Â  Â  gameArea.appendChild(particle);
Â  Â  Â  Â  particles.push({ element: particle, vx, vy, life: 30 });
Â  Â  Â  }
Â  Â  }

Â  Â  function updateParticles() {
Â  Â  Â  particles.forEach((particle, index) => {
Â  Â  Â  Â  particle.element.style.left = parseFloat(particle.element.style.left) + particle.vx + "px";
Â  Â  Â  Â  particle.element.style.top = parseFloat(particle.element.style.top) + particle.vy + "px";
Â  Â  Â  Â  particle.life--;

Â  Â  Â  Â  if (particle.life <= 0) {
Â  Â  Â  Â  Â  particle.element.remove();
Â  Â  Â  Â  Â  particles.splice(index, 1);
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  }

Â  Â  function createSpeedLines() {
Â  Â  Â  // Remove old speed lines
Â  Â  Â  speedLines.forEach(line => line.remove());
Â  D Â  Â  speedLines = [];

Â  Â  Â  // Create new speed lines
Â  Â  Â  for (let i = 0; i < 8; i++) {
Â  Â  Â  Â  let line = document.createElement('div');
Â  Â  Â  Â  line.classList.add('speed-line');
	  // MODIFIED: Use clientWidth for dynamic sizing
Â  Â  Â  Â  line.style.left = (Math.random() * gameArea.clientWidth) + "px"; 
Â  Â  Â  Â  line.style.top = (-30 - Math.random() * 600) + "px";
Â  Â  Â  Â  line.speed = 5 + Math.random() * 5;
Â  Â  Â  Â  gameArea.appendChild(line);
Â  Â  Â  Â  speedLines.push(line);
Â  Â  Â  }
Â  Â  }

Â  Â  function moveSpeedLines() {
Â  Â  Â  speedLines.forEach(line => {
Â  Â  Â  Â  let top = parseFloat(line.style.top);
Â  Â  Â  Â  top += player.speed + line.speed;

Â  Â  Â  Â  if (top > 600) {
Â  Â  Â  Â  Â  top = -30;
		// MODIFIED: Use clientWidth for dynamic sizing
Â  Â  Â  Â  Â  line.style.left = (Math.random() * gameArea.clientWidth) + "px";
Â  Â  Â  Â  }

Â  Â  Â  Â  line.style.top = top + "px";
Â  Â  Â  });
Â  Â  }

Â  Â  function playGame() {
Â  Â  Â  if (!player.start) return;
Â  Â  Â  moveLines();
Â  Â  Â  moveEnemies();
Â  Â  Â  updateParticles();
Â  Â  Â  moveSpeedLines();

Â  Â  Â  if (keys.ArrowLeft && player.lane > 0) player.lane--;
Â  Â  Â  if (keys.ArrowRight && player.lane < 3) player.lane++;
Â  Â  Â  keys.ArrowLeft = false;
Â  Â  Â  keys.ArrowRight = false;

Â  Â  Â  car.style.left = lanePositions[player.lane] + "px";
Â  Â  Â  animationId = requestAnimationFrame(playGame);
Â  Â  }

Â  Â  function startGame() {
Â  Â  Â  player.start = true;
Â  Â  Â  player.score = 0;
Â  Â  Â  player.lane = 1; // Start in 2nd lane
Â  Â  Â  player.speed = 5;
Â  Â  Â  scoreDisplay.textContent = "Score: 0";
Â  Â  Â  speedDisplay.textContent = "Speed: 5";
Â  Â  Â  gameOverScreen.style.display = 'none';

Â  	// MODIFIED: Setup dimensions and cache player position
Â  Â  Â  setupGameDimensions(); 
Â  Â  Â  playerTop = car.offsetTop; 

Â  Â  Â  enemies.forEach(e => e.remove());
Â  Â  Â  enemies = [];
Â  Â  Â  createEnemies();
Â  Â  Â  createSpeedLines();
Â  Â  Â  playGame();
Â  Â  }

Â  Â  function endGame() {
Â  Â  Â  player.start = false;
Â  Â  Â  cancelAnimationFrame(animationId);
Â  Â  Â  finalScoreDisplay.textContent = player.score;
Â  Â  Â  gameOverScreen.style.display = 'flex';
Â  Â  }

Â  Â  // Keyboard controls
Â  Â  document.addEventListener('keydown', (e) => {
Â  Â  Â  if (e.key === 'ArrowLeft' || e.key === 'ArrowRight') {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  keys[e.key] = true;
Â  Â  Â  }
Â  Â  });

Â  Â  // Mobile touch controls (Buttons - you can keep or remove these)
Â  Â  document.getElementById('leftBtn').addEventListener('touchstart', () => keys.ArrowLeft = true);
Â  Â  document.getElementById('rightBtn').addEventListener('touchstart', () => keys.ArrowRight = true);
Â  Â  document.getElementById('leftBtn').addEventListener('touchend', () => keys.ArrowLeft = false);
Â  Â  document.getElementById('rightBtn').addEventListener('touchend', () => keys.ArrowRight = false);

Â  Â  // Click controls for desktop (Buttons)
Â  Â  document.getElementById('leftBtn').addEventListener('mousedown', () => keys.ArrowLeft = true);
Â  Â  document.getElementById('rightBtn').addEventListener('mousedown', () => keys.ArrowRight = true);
Â  Â  document.getElementById('leftBtn').addEventListener('mouseup', () => keys.ArrowLeft = false);
Â  Â  document.getElementById('rightBtn').addEventListener('mouseup', () => keys.ArrowRight = false);
Â  Â  document.getElementById('leftBtn').addEventListener('mouseleave', () => keys.ArrowLeft = false);
Â  Â  document.getElementById('rightBtn').addEventListener('mouseleave', () => keys.ArrowLeft = false);


Â  Â  // --- NEW: Mobile SWIPE controls ---
Â  Â  gameArea.addEventListener('touchstart', (e) => {
Â  Â  Â  // Check if the event target is not the restart button
Â  Â  Â  if (e.target.id !== 'restartBtn') {
Â  Â  Â  Â  e.preventDefault(); // Prevent screen bounce
Â  Â  Â  Â  touchStartX = e.touches[0].clientX;
Â  Â  Â  Â  touchStartY = e.touches[0].clientY;
Â  Â  Â  }
Â  Â  }, { passive: false }); // Need passive: false for preventDefault

Â  Â  gameArea.addEventListener('touchend', (e) => {
Â  Â  Â  // Check if the event target is not the restart button
Â  Â  	if (e.target.id !== 'restartBtn') {
Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  let touchEndX = e.changedTouches[0].clientX;
Â  Â  Â  Â  let touchEndY = e.changedTouches[0].clientY;

Â  Â  Â  Â  let dx = touchEndX - touchStartX;
Â  Â  Â  Â  let dy = touchEndY - touchStartY;

Â  Â  Â  Â  const swipeThreshold = 50; // Minimum distance (px) for a swipe

Â  Â  Â  Â  // Check if it's primarily a horizontal swipe and meets the threshold
Â  Â  Â  Â  if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > swipeThreshold) {
Â  Â  Â  Â  Â  if (dx < 0) {
Â  Â  Â  Â  Â  Â  // Swipe Left
Â  Â  Â  Â  Â  Â  keys.ArrowLeft = true;
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  // Swipe Right
Â  Â  Â  Â  Â  Â  keys.ArrowRight = true;
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }, { passive: false });
Â  Â  // --- End of new swipe controls ---


Â  Â  restartBtn.addEventListener('click', startGame);

Â  Â  // NEW: Listen for resize events to update layout
Â  Â  window.addEventListener('resize', setupGameDimensions);

Â  Â  startGame();
Â  </script>
</body>

</html>
